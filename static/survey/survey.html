<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8"/>
  <script src="../jspsych.js"></script>
  <script src="../plugins/jspsych-instructions.js"></script>
  <script src="../plugins/jspsych-survey-text.js"></script>
  <script src="../plugins/jspsych-survey-multi-select.js"></script>
  <script src="../plugins/jspsych-survey-likert.js"></script>
  <script src="../plugins/jspsych-external-html.js"></script>
  <script src="../plugins/jspsych-call-function.js"></script>
  <script src="../plugins/jspsych-html-keyboard-response.js"></script>
  <link rel="stylesheet" href="../css/jspsych.css"></link>
  <style>
    img {
      width: 300px;
    }
  </style>
</head>

<body>
</body>

<script>
  timeline = []
  // adapted from https://www.jspsych.org/overview/data/
  function saveData() {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '../../survey_data'); // change 'write_data.php' to point to php script.
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(jsPsych.data.get().json());
  }

  var urlvar = jsPsych.data.urlVariables()

  jsPsych.data.addProperties({
                  url_variables: urlvar
              });

   timeline.push({type: 'survey-text',
  questions: [
    {prompt: "What is the survey code you received from the HIT instructions? Please feel free to go back to the instructions to find it.", rows: 5, columns: 40}]});
              
  timeline.push({
    type: 'call-function',
    func: saveData
  });

  timeline.push({
    type: 'html-keyboard-response',
    stimulus: "Thank you! Click <a href =\"https://reg.complicex.science/~xc/instructions/tiny-complete\">here</a> to return to the app.",
    choice: jsPsych.NO_KEYS 
});
   

  
  jsPsych.init({timeline: timeline,
  show_progress_bar: true,
  on_close: function(){
    saveData();
  },
  on_data_update: function() {
    saveData();
  }
  });
</script>
</html>